# Docker éƒ¨ç½²æŒ‡å—

æœ¬ç›®å½•åŒ…å«äº‘æœåŠ¡å™¨ Docker éƒ¨ç½²ç›¸å…³çš„æ‰€æœ‰æ–‡æ¡£å’Œè„šæœ¬ã€‚

## ğŸ“š æ–‡æ¡£ç»“æ„

### æ ¸å¿ƒæ–‡æ¡£
- **docker-deployment-guide.md** - Docker éƒ¨ç½²å®Œæ•´æŒ‡å—ï¼ˆè‹±æ–‡ï¼ŒåŒ…å«å¤šæ¶æ„æ„å»ºè¯´æ˜ï¼‰
- **guide.md** - æœ¬æ–‡ä»¶ï¼Œå¿«é€Ÿå‚è€ƒæŒ‡å—

### äº‘æœåŠ¡æ–‡æ¡£ (`cloud/`)
- **é˜¿é‡Œäº‘æœåŠ¡.md** - é˜¿é‡Œäº‘æœåŠ¡å™¨é…ç½®å’ŒæœåŠ¡ä¿¡æ¯
- **è…¾è®¯äº‘æœåŠ¡.md** - è…¾è®¯äº‘æœåŠ¡å™¨é…ç½®å’ŒæœåŠ¡ä¿¡æ¯

### å ¡å’æœºéƒ¨ç½²æ–‡æ¡£ (`bastion/`)
- **bastion-deployment-guide.md** - å ¡å’æœº Docker æœåŠ¡éƒ¨ç½²æŒ‡å—
- **unified-deploy-guide.md** - ç»Ÿä¸€éƒ¨ç½²æŒ‡å—
- **äº‘ç«¯é¡¹ç›®æ›´æ–°æ ‡å‡†æµç¨‹.md** - äº‘ç«¯é¡¹ç›®æ›´æ–°æµç¨‹
- **å•é¡¹ç›®å¿«æ·éƒ¨ç½²ä½¿ç”¨æŒ‡å—.md** - å•é¡¹ç›®å¿«é€Ÿéƒ¨ç½²æŒ‡å—
- **é¡¹ç›®æ›´æ–°å‡çº§æŒ‡å—.md** - é¡¹ç›®æ›´æ–°å‡çº§æµç¨‹
- **ALL_PROJECTS_DATA_MIGRATION.md** - æ•°æ®è¿ç§»æŒ‡å—

### åŸºäºé•œåƒä»“åº“çš„å®Œæ•´éƒ¨ç½²æµç¨‹
éƒ¨ç½²æµç¨‹å¦‚ä¸‹ï¼š æœ¬åœ°æ„å»º (amd64) -> æ¨é€åˆ°é˜¿é‡Œäº‘ -> ç”Ÿæˆéƒ¨ç½²æ–‡ä»¶ -> SSH è¿æ¥æœåŠ¡å™¨ -> ä¸Šä¼ æ–‡ä»¶ -> Docker Pull -> Docker Up ã€‚


## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ¬åœ°åŒ–éƒ¨ç½²æµç¨‹ï¼ˆPM2ï¼‰
1. æ£€æŸ¥æœ¬åœ°å·¥å…·ï¼ˆsshpass, node, npmï¼‰
2. æ„å»ºå‰ç«¯ç”Ÿäº§ç‰ˆæœ¬
3. æ£€æŸ¥æœåŠ¡å™¨è¿æ¥
4. å®‰è£…æœåŠ¡å™¨å·¥å…·ï¼ˆNode.js, PM2, Nginxï¼‰
5. ä¸Šä¼ é¡¹ç›®æ–‡ä»¶
6. åŒæ­¥æ•°æ®åº“å’Œé…ç½®æ–‡ä»¶
7. å®‰è£…æœåŠ¡å™¨ä¾èµ–
8. é…ç½® PM2ï¼ˆåç«¯æœåŠ¡ï¼‰
9. é…ç½®å‰ç«¯æœåŠ¡
10. é…ç½® Nginx åå‘ä»£ç†
11. éªŒè¯éƒ¨ç½²


### Docker åŒ–éƒ¨ç½²
1. æ¸…ç†äº‘ç«¯å·²éƒ¨ç½²çš„æœ¬é¡¹ç›®å’Œæœ¬åœ°æ—§çš„dockerç‰ˆæœ¬é¡¹ç›®æ–‡ä»¶
2. å…ˆåœ¨æœ¬åœ°dockeræ„å»ºéªŒè¯å¯è¿è¡Œ
3. å¯¼å‡ºdockeré•œåƒï¼ˆæ„å»º linux/amd64 é•œåƒï¼‰
4. ä¸Šä¼ é¡¹ç›®é•œåƒåˆ°æœåŠ¡å™¨
5. åœ¨æœåŠ¡å™¨ä¸Šå¯åŠ¨ Docker æœåŠ¡
6. å¯¼å‡ºæœ¬åœ°æ•°æ®åº“å¹¶å¯¼å…¥äº‘ç«¯éƒ¨ç½²é¡¹ç›®
7. éªŒè¯éƒ¨ç½²çŠ¶æ€


### å ¡å’æœºéƒ¨ç½²æ–¹å¼
1. æ¸…ç†äº‘ç«¯å·²éƒ¨ç½²çš„æœ¬é¡¹ç›®å’Œæœ¬åœ°æ—§çš„dockerç‰ˆæœ¬é¡¹ç›®æ–‡ä»¶
2. å…ˆåœ¨æœ¬åœ°dockeræ„å»ºéªŒè¯å¯è¿è¡Œ
3. åˆ›å»ºtaræ–‡ä»¶ï¼Œå¯¼å‡ºæœ¬åœ°æ•°æ®åº“ä¸­æœ€æ–°æ•°æ®ï¼ŒåŒ…å«å¿«é€Ÿéƒ¨ç½²æ–‡ä»¶ï¼ˆåŒ…å«äº‘ç«¯å†å²é¡¹ç›®æ¸…ç†./scripts/cleanup.shï¼Œå¿«é€Ÿdockeréƒ¨ç½²./scripts/deploy.shï¼ŒæœåŠ¡çŠ¶æ€éªŒè¯./scripts/verify.shï¼‰
4. é€šè¿‡WindTermå ¡å’æœºä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
5. è§£å‹ç¼©åï¼Œé€šè¿‡å¿«æ·å®‰è£…æ–‡ä»¶è¿›è¡Œé¡¹ç›®dockeråŒ–å®‰è£…ï¼ŒåŒ…å«è‡ªåŠ¨å¯¼å…¥æ•°æ®åˆ°äº‘ç«¯éƒ¨ç½²é¡¹ç›®
7. éªŒè¯éƒ¨ç½²çŠ¶æ€



## ğŸ“¦ è„šæœ¬ç›®å½• (`../scripts/`)

### å¥åº·æ£€æŸ¥ (`scripts/health/`)
- `health_check_aliyun.sh` - é˜¿é‡Œäº‘æœåŠ¡å™¨å¥åº·æ£€æŸ¥
- `health_check_tencent.sh` - è…¾è®¯äº‘æœåŠ¡å™¨å¥åº·æ£€æŸ¥

### éƒ¨ç½²è„šæœ¬ (`scripts/deploy/`)
- `prepare_deployment.sh` - éƒ¨ç½²å‡†å¤‡è„šæœ¬
- å…¶ä»–éƒ¨ç½²ç›¸å…³è„šæœ¬

### æ¸…ç†è„šæœ¬ (`scripts/clean/`)
- `clean_docker_images.sh` - Docker é•œåƒæ¸…ç†
- `clean_images_aliyun.sh` - é˜¿é‡Œäº‘é•œåƒæ¸…ç†
- `clean_images_aliyun_quick.sh` - é˜¿é‡Œäº‘å¿«é€Ÿæ¸…ç†

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### çŠ¶æ€éªŒè¯
```bash
# æŸ¥çœ‹çŠ¶æ€
./aliyun-quick-status.sh

# æŸ¥çœ‹æ—¥å¿—
./aliyun-quick-logs.sh -f

# è®¿é—®æœåŠ¡
open http://47.113.225.93:8118
```

### åŠ é€Ÿé…ç½®
- **apt é•œåƒ**ï¼šä½¿ç”¨é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿç³»ç»ŸåŒ…ä¸‹è½½
  ```dockerfile
  RUN sed -i 's/deb.debian.org/mirrors.aliyun.com/g' /etc/apt/sources.list.d/debian.sources 2>/dev/null || \
      sed -i 's/deb.debian.org/mirrors.aliyun.com/g' /etc/apt/sources.list 2>/dev/null || true
  ```

- **pip é•œåƒ**ï¼šä½¿ç”¨æ¸…åé•œåƒåŠ é€Ÿ Python åŒ…ä¸‹è½½
  ```dockerfile
  RUN pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple && \
      pip config set global.trusted-host pypi.tuna.tsinghua.edu.cn
  ```



## ğŸ“– è¯¦ç»†æ–‡æ¡£

æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹ï¼š
- Docker éƒ¨ç½²ï¼š`docker-deployment-guide.md`
- é˜¿é‡Œäº‘æœåŠ¡ï¼š`cloud/é˜¿é‡Œäº‘æœåŠ¡.md`
- è…¾è®¯äº‘æœåŠ¡ï¼š`cloud/è…¾è®¯äº‘æœåŠ¡.md`
- å ¡å’æœºéƒ¨ç½²ï¼š`bastion/bastion-deployment-guide.md`

## ğŸ“ ç¤ºä¾‹é…ç½®

### é˜¿é‡Œäº‘æœåŠ¡é…ç½®ç¤ºä¾‹
- æœåŠ¡åï¼štodify4
- å¯¹å¤–ç«¯å£ï¼š8118ï¼ˆNginxï¼‰
- å‰ç«¯æœ¬åœ°ç«¯å£ï¼š8111ï¼ˆPM2ï¼‰
- åç«¯æœ¬åœ°ç«¯å£ï¼š8113ï¼ˆPM2ï¼‰
- æœåŠ¡å™¨ï¼šroot@47.113.225.93
- éƒ¨ç½²è·¯å¾„ï¼š/root/todify4
