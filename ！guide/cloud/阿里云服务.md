

#### 服务器信息
操作系统：OpenCloudOS
宿主机系统 ：OpenCloudOS 使用 yum / dnf



#### 授权管理

授权你，使用sshpass工具自动输入密码进行SSH连接，执行操作
sshpass -p 'Qb89100820' ssh -o StrictHostKeyChecking=no root@47.113.225.93 
在不要影响现有正在运行的服务为前提：
服务器使用宝塔面板的 Nginx


#### 非 Docker 部署方案（PM2）
1. 本地构建：构建 Next.js 生产版本
2. 打包文件：打包构建产物和必要文件
3. 上传到云端：通过 SCP 上传到服务器
4. 服务器配置：安装 Node.js、PM2 和依赖
5. 启动服务：使用 PM2 管理进程




##### 在运行的服务&接口
http://47.113.225.93:9898  -服务名：todify 1.0， 对外服务：9898，本地：前端 ：1001，后：1003 （PM2）
http://47.113.225.93:8088 - 服务名：todify2， 对外服务：8088，本地：前端 ：2001，后：2003 （PM2）
http://47.113.225.93:8089 - 服务名：todify3， 对外服务：8089，本地：前端 ：2201，后：2203 （PM2）
http://47.113.225.93:7777 - 服务名：AI画布，对外服务：7777，本地：前端 ：4001，后：4003 （PM2）



### 阿里云服务器端口占用完整报告

#### 对外访问端口（0.0.0.0）

|端口|服务|进程/容器|
|---|---|---|
|22|SSH 服务|sshd|
|80|Nginx HTTP|nginx|
|111|RPC 服务|systemd|
|443|Docker HTTPS|dify-nginx-1|
|5003|Docker 应用|dify-plugin_daemon-1|
|5555|Prisma Studio|node (IPv6)|
|8888|宝塔面板|python3 (BT-Panel)|
|9898|Nginx todify_9898|nginx|
|9999|Docker Dify 服务|dify-nginx-1|

#### 本地服务端口（127.0.0.1）

|端口|服务|进程|
|---|---|---|
|25|SMTP 邮件|master|
|5432|PostgreSQL|postgres|
|6379|Redis|redis-server|
|38429|Containerd|containerd|

#### 数据库端口

- 3306 - MySQL (IPv6)

- 5432 - PostgreSQL (本地)

#### Docker 容器服务

- dify-nginx-1: 443, 9999 (对外)

- dify-plugin_daemon-1: 5003 (对外)

- dify-api-1: 5001 (内部)

- dify-web-1: 3000 (内部)

- dify-db-1: 5432 (内部)

- dify-redis-1: 6379 (内部)

#### Node.js 进程

- PM2 Dify Web 服务 (PID: 690005)

- Prisma Studio (PID: 782443, 端口: 5555)

- 多个 ts-node-dev 开发进程 (5个进程，可能为遗留)


#### 保留的服务

- 9898 - todify_9898 服务（正常运行）


### 服务器健康评估

#### 健康检查脚本

已创建健康检查脚本：`health_check.sh`

执行方式：
```bash
./health_check.sh
```

#### 健康评估检查项

1. **系统基本信息** - 操作系统版本、内核信息
2. **系统负载** - CPU负载、运行时间
3. **CPU 使用情况** - CPU使用率、进程占用
4. **内存使用情况** - 内存总量、已用、可用、缓存
5. **磁盘使用情况** - 各分区使用率
6. **磁盘IO情况** - 磁盘读写性能
7. **网络连接统计** - 连接数、状态分布
8. **PM2 服务状态** - 所有PM2管理的服务状态
9. **Docker 容器状态** - 容器运行状态
10. **Nginx 状态** - Web服务器状态
11. **关键服务端口监听** - 端口占用情况
12. **系统进程统计** - 总进程数
13. **系统错误日志** - 最近错误信息
14. **系统更新检查** - 可用更新包
15. **数据库服务状态** - PostgreSQL/MySQL状态
16. **Redis 服务状态** - 缓存服务状态
17. **服务响应测试** - HTTP服务可用性测试
18. **系统资源使用趋势** - CPU、内存、IO趋势

#### 健康评估结果

**执行时间**: 2026-01-09

**服务响应测试结果**:
- ✅ todify 1.0 (9898): HTTP 200, 响应时间 0.29s - **正常**
- ✅ todify2 (8088): HTTP 200, 响应时间 0.16s - **正常**
- ❌ todify3 (8089): 连接超时 (45s) - **异常，需要检查**
- ❌ AI画布 (7777): 连接超时 (45s) - **异常，需要检查**

**建议**:
1. 检查 todify3 (8089) 和 AI画布 (7777) 服务的PM2进程状态
2. 检查这两个服务的Nginx配置是否正确
3. 检查服务器防火墙规则是否允许这些端口访问
4. 在本地终端执行 `./health_check.sh` 获取完整的系统资源评估数据

**完整评估**: 请在本地终端执行 `./health_check.sh` 获取完整的18项健康检查结果

